[tox]
isolated_build = True
skipsdist = True

[testenv]
package = wheel
wheel_build_env = .pkg
deps =
  -r dev-requirements.txt

[testenv:ci_phoenix_evals]
changedir = packages/phoenix-evals/
commands_pre = uv pip install --reinstall .[test]
commands =
  ruff format --diff .
  ruff check --no-fix .
  mypy .
  pytest {posargs:.}

[testenv:ci_phoenix_otel]
changedir = packages/phoenix-otel/
commands_pre = uv pip install --reinstall .[test]
commands =
  ruff format --diff .
  ruff check --no-fix .
  mypy .
  ; pytest {posargs:.}

[testenv:ci_integration_tests]
changedir = tests/
commands_pre =
  uv pip install --reinstall ../.[pg]
  uv pip install -r integration/requirements.txt
commands =
  ruff format --diff .
  ruff check --no-fix integration
  mypy integration
  pytest {posargs:integration}

[testenv:phoenix_evals]
changedir = packages/phoenix-evals/
commands_pre = uv pip install --reinstall .[test]
commands =
  ruff format .
  ruff check --fix .
  mypy .
  pytest {posargs:.}

[testenv:phoenix_otel]
changedir = packages/phoenix-otel/
commands_pre = uv pip install --reinstall .[test]
commands =
  ruff format .
  ruff check --fix .
  mypy .
  ; pytest {posargs:.}

[testenv:integration_tests]
changedir = tests/
commands_pre =
  uv pip install --reinstall ../.[pg]
  uv pip install -r integration/requirements.txt
commands =
  ruff format integration
  ruff check --fix integration
  mypy integration
  pytest {posargs:integration}
