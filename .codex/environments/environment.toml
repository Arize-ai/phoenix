# THIS IS AUTOGENERATED. DO NOT EDIT MANUALLY
version = 1
name = "phoenix"

[setup]
script = '''
uv sync --python 3.10
cd app
pnpm install

WORKTREE_PATH="$(dirname "$(pwd)")"
PORT_OFFSET="$(printf '%s' "${WORKTREE_PATH}" | cksum | awk '{print $1 % 1000}')"
PHOENIX_PORT="$((6006 + PORT_OFFSET))"
VITE_PORT="$((5173 + PORT_OFFSET))"
DEBUGPY_PORT="$((5678 + PORT_OFFSET))"

touch .env
perl -i -ne 'print unless /^(?:export\\s+)?(?:PHOENIX_WORKING_DIR|PHOENIX_PORT|VITE_PORT|DEBUGPY_PORT)=/' .env
cat >> .env <<EOF
# Managed by Codex environment setup.
export PHOENIX_WORKING_DIR=../
export PHOENIX_PORT=${PHOENIX_PORT}
export VITE_PORT=${VITE_PORT}
export DEBUGPY_PORT=${DEBUGPY_PORT}
EOF
cd ..
'''

[[actions]]
name = "run"
icon = "tool"
command = '''
cd app
[ -f ./.env ] && source ./.env
pnpm dev
'''
