# THIS IS AUTOGENERATED. DO NOT EDIT MANUALLY
version = 1
name = "phoenix"

[setup]
script = '''
uv sync --python 3.10
cd app
pnpm install
WORKTREE_PATH="$(dirname "$(pwd)")"
WORKTREE_ID="$(basename "$(dirname "${WORKTREE_PATH}")")"
PORT_OFFSET="$(printf '%s' "${WORKTREE_PATH}" | cksum | awk '{print $1 % 1000}')"
PHOENIX_PORT="$((6006 + PORT_OFFSET))"
PHOENIX_WORKING_DIR="/tmp/${WORKTREE_ID}"
VITE_PORT="$((5173 + PORT_OFFSET))"
DEBUGPY_PORT="$((5678 + PORT_OFFSET))"

mkdir -p "${PHOENIX_WORKING_DIR}"

touch .env

cat >> .env <<EOF
export PHOENIX_PORT=${PHOENIX_PORT}
export PHOENIX_WORKING_DIR=${PHOENIX_WORKING_DIR}
export VITE_PORT=${VITE_PORT}
export DEBUGPY_PORT=${DEBUGPY_PORT}
EOF

cd ..
'''

[[actions]]
name = "run"
icon = "tool"
command = '''
cd app
pnpm dev
'''
